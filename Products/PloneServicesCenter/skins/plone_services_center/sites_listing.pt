<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="ploneservicescenter">

  <body>
    <div metal:fill-slot="main"
         tal:define="country_tool context/portal_countryutils;
                     countries_dict country_tool/getCountryIsoDict; 
                     countries python:request.get('countries',[]); 
                     industries_vocab context/getIndustryVocabulary;
                     industries python:request.get('industries',[]);
                     sites python: here.getSitesUsingPlone(countries=countries, industries=industries);
                     batch_size python:request.get('batch_size', 20);
                     b_start request/b_start|string:0;
                     Batch python:modules['Products.CMFPlone'].Batch;
                     global batch python:Batch(sites, batch_size, int(b_start))">

      <h1 class="documentFirstHeading" i18n:translate="label_siteslist_plonesite">Plone Sites</h1>

      <form tal:attributes="action string:${here_url}/${template_id}">
        <div>
          <div style="float: right">
            <tal:filter-form metal:use-macro="here/psc_macros/macros/filter-form"/>
          </div>
          <div>
            <p i18n:translate="help_siteslist_plonesite">
              The following listing shows Plone-based websites around the
              world. The featured sites focus on high-profile sites that
              highlight an interesting use of the Plone CMS. If the site was
              deployed by a Plone service provider, it is listed as well.
            </p>
            <p class="discreet" i18n:translate="label_siteslist_custom">
              You can customize the listing by selecting countries and industries on the right.
            </p>
            <p style="text-align: right" i18n:translate="label_siteslist_currentsites">
              Currently listing <strong><span i18n:name="label_siteslist_counts" tal:replace="python:len(sites)" /> sites</strong> powered by Plone.
            </p>
          </div>
        </div>
      </form>

      <tal:if tal:condition="not: sites">
        <tal:nothing-found metal:use-macro="here/psc_macros/macros/nothing-found"/>
      </tal:if>

      <div tal:condition="sites">

        <div metal:use-macro="here/batch_macros/macros/navigation" />
        
        <div tal:repeat="brain batch">

          <div tal:define="base_url string:${here/absolute_url}/${template/getId};
                           industries python: here.makeIndustryLinks(base_url, brain)">

          <div tal:condition="python: brain.getRating == 1"
               class="listing-site level1">

            <h2>
              <a tal:attributes="href brain/getURL"
                 tal:content="brain/Title">
                Title
              </a>
            </h2>

            <a tal:attributes="href brain/getURL"
               class="listing-site-image-link">
              <img alt=""
                   tal:attributes="src string:${brain/getURL}/screenshot_thumb;
                                   title brain/Title;
                                   alt brain/Title" />
            </a>

            <p tal:content="brain/Description">
              Description
            </p>

            <div class="first-infos"
                 tal:define="site brain/getObject">
              <span tal:define="country brain/getCountry"
                    tal:condition="country">
                <strong i18n:translate="label_psc_country">Country:</strong>
                <a tal:content="python: countries_dict.get(country, country)"
                   tal:attributes="href string:${base_url}?countries:list=${country}" />
              </span>
              <span tal:condition="brain/getIndustry">
                <strong i18n:translate="label_psc_industry">Industry:</strong>
                <span tal:replace="structure industries" />
              </span>
<!-- commented out for now, we shouldn't show bare email addresses
              <span tal:define="contact_email site/getContactEmail;
                                contact_name site/getContactName"
                    tal:condition="contact_email">
                <strong>Contact:</strong>
                <tal:display-contact metal:use-macro="here/psc_macros/macros/display-contact"/>
              </span>
-->
              <tal:if tal:condition="site/canSeeProvider">
                <span tal:define="provider site/getProvider">
                  <strong i18n:translate="label_psc_provider">Provider:</strong>
                  <tal:display-provider metal:use-macro="here/psc_macros/macros/display-provider"/>
                </span>
              </tal:if>
            </div>
          </div>

          <div class="listing-site level2"
               tal:condition="python: brain.getRating in (2,3)">
            <h3>
              <a tal:attributes="href brain/getURL"
                 tal:content="brain/Title">
                Site title
              </a>
            </h3>
            
            <a tal:attributes="href brain/getURL"
               class="listing-site-image-link">
              <img alt=""
                   tal:attributes="src string:${brain/getURL}/screenshot_thumb;
                                   title brain/Title;
                                   alt brain/Title" />
            </a>
            
            <p tal:content="brain/Description"></p>
            <div class="second-infos"
                 tal:define="site brain/getObject">
              <span tal:define="country brain/getCountry"
                    tal:condition="country">
                <strong i18n:translate="label_siteslist_country">Country:</strong>
                <a tal:content="python: countries_dict.get(country, country)"
                   tal:attributes="href string:${base_url}?countries:list=${country}" />
              </span>
              <span tal:condition="brain/getIndustry">
                <strong i18n:translate="label_siteslist_industry">Industry:</strong>
                <span tal:replace="structure industries" />
              </span>
<!-- commented out for now, we shouldn't show bare email addresses
              <span tal:define="contact_email site/getContactEmail;
                                contact_name site/getContactName"
                    tal:condition="contact_email">
                <strong>Contact:</strong>
                <tal:display-contact metal:use-macro="here/psc_macros/macros/display-contact"/>
              </span>
-->
              <tal:if tal:condition="site/canSeeProvider">
                <span tal:define="provider site/getProvider">
                  <strong i18n:translate="label_psc_provider">Provider:</strong>
                  <tal:display-provider metal:use-macro="here/psc_macros/macros/display-provider"/>
                </span>
              </tal:if>
            </div>
          </div>
          

        </div>
        </div>
        <div metal:use-macro="here/batch_macros/macros/navigation" />
      </div>
    </div>
  </body>
</html>
